<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge" />

  <title>Kamranicus - Flattening Deeply Nested Components in React</title>
  <meta name="description" content="Kamran Ayub" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Kamran Ayub">

  <link href="http://feeds.feedburner.com/Kamranicus" rel="alternate" title="Kamranicus (RSS)" type="application/atom+xml">
  <link rel="shortcut icon" href="/favicon.png" type="image/png">
  <link rel="icon" href="/favicon.png" type="image/png">

  <link href="/assets/ui/semantic.min.css" rel="stylesheet" />
  <link href="/assets/css/highlight.css" rel="stylesheet">

  <meta name="application-name" content="Kamranicus" />
  <meta name="msapplication-tooltip" content="Kamranicus" />
  <meta name="msapplication-starturl" content="/" />

  <meta property="og:title" content="Kamranicus - Flattening Deeply Nested Components in React" /> 
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://kamranicus.com/posts/2018-07-07-react-nesting-components-flat" />
  <meta property="og:site_name" content="Kamranicus" />

  <!-- TODO: More social graph meta tags -->
  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "WebSite",
      "name": "Kamranicus",
      "url": "https://kamranicus.com/",
      "sameAs": [
        "http://www.twitter.com/kamranayub"
      ]
  }
  </script>


  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="/assets/js/html5shiv.js"></script>
    <script src="/assets/js/respond.min.js"></script>
  <![endif]-->
  <script src="/assets/js/picturefill.min.js" async></script>

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1203259-13']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  

  


</head>

<body>

  <!-- Navigation -->
  <div class="ui container">
    <nav class="ui huge text site menu">
      
      <a class="header item" href="/">Kamranicus</a>
      
      <div class="ui right item">
              <div class="item">
        <a href="/about">Get in Touch</a>
      </div>
      <div class="item">
        <a href="/events">Events</a>
      </div>
      <div class="item">
        <a href="/guides">Guides</a>
      </div>
      <div class="item">
        <a href="/projects">Projects</a>
      </div>
      <div class="item">
        <a href="/travel">Travel</a>
      </div>

      </div>
    </nav>
  </div>
  <!-- Page Header -->

  <header class="ui vertical masthead segment " id="intro-header">
    <div class="ui container">

    
<div class="ui basic vertical segment">
    <h1 class="ui  huge header">
      Flattening Deeply Nested Components in React
        <div class="ui sub header">JSX is neat until you start getting into situations where things have to be nested deeply</div>
    </h1>
                
    <div class="ui  sub header">        
Published on Saturday, July 7, 2018<br>    </div>
        <div class="ui basic vertical spaced segment">
                    <a role="button" href="/tags/JavaScript" class="ui small compact button">JavaScript</a>
                    <a role="button" href="/tags/React" class="ui small compact button">React</a>
                    <a role="button" href="/tags/TypeScript" class="ui small compact button">TypeScript</a>
        </div>     
</div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="ui stackable grid container">
    <div class="content column">
      

<div class="ui huge basic post content segment">
  <p>Here's a quick tip. Often in entry points of React applications, you have to do some bootstrapping with various providers from dependent modules like Material UI, Redux, JSS, and React Router. That's exactly the stack I'm using so that's what my example is based on.</p>
<p>Normally, you would do this to bootstrap your <code>App</code> component:</p>
<pre><code class="language-js">React.render(
  &lt;Provider store={store}&gt;
    &lt;ConnectedRouter history={history}&gt;
      &lt;JssProvider jss={jss} generateClassName={generateClassName}&gt;
        &lt;MuiThemeProvider theme={theme}&gt;
          &lt;MuiPickersUtilsProvider utils={MomentUtils}&gt;
            &lt;App /&gt; {/* FINALLY */}
          &lt;/MuiPickersUtilsProvider&gt;
        &lt;/MuiThemeProvider&gt;
      &lt;/JssProvider&gt;
    &lt;/ConnectedRouter&gt;
  &lt;/Provider&gt;
)
</code></pre>
<p>It feels like I'm in Dante's Inferno creating the 9 circles of hell. I'm being dramatic of course--this is readable and probably fine. But there are situations with nesting even worse than this. If you're interested in how to flatten this out, read on.</p>
<h2 id="recompose">Recompose</h2>
<p>I like the <a href="#recompose">recompose</a> utility library, it adds some functional helpers to React apps. One helper that we'll leverage here is called <code>nest</code>:</p>
<pre><code class="language-js">import { nest } from &quot;recompose&quot;;

const AppProviders = nest(
  Provider,
  ConnectedRouter,
  JssProvider,
  MuiThemeProvider,
  MuiPickersUtilsProvider
);

ReactDOM.render(
  &lt;AppProviders 
    store={store} 
    history={history} 
    jss={jss} 
    generateClassName={generateClassName} 
    theme={theme} 
    utils={MomentUtils}
  &gt;    
    &lt;App /&gt; {/* That's a bit better */}
  &lt;/AppProviders&gt;,
  document.getElementById('root')
)
</code></pre>
<p>This actually works. What's happening here is that <code>nest</code> will take each component you give it and nest one after the other, in order of top to bottom. What you can do then is pass props that <strong>get passed to each nested component</strong>. This is the important bit and as it turns out will cause warnings in the console because some components have prop validation that will get angry at you if you pass them props they don't expect.</p>
<pre><code>index.js:2178 Warning: Failed prop type: The following properties are not supported: `store`, `history`, `jss`, `generateClassName`, `utils`. Please remove them.
    in MuiThemeProvider (created by nest(Provider, ConnectedRouter, JssProvider, MuiThemeProvider, MuiPickersUtilsProvider))
    in nest(Provider, ConnectedRouter, JssProvider, MuiThemeProvider, MuiPickersUtilsProvider)
</code></pre>
<p>Oopsie. <code>nest</code> does accept stateless components as arguments, though. Let's do that!</p>
<h2 id="nest-with-stateless-components">Nest with Stateless Components</h2>
<pre><code class="language-js">import { nest } from &quot;recompose&quot;;

// Nest providers in this order (top to bottom)
const withProviders = wrap(
  ({ children }) =&gt; &lt;Provider store={store}&gt;{children}&lt;/Provider&gt;,
  ({ children }) =&gt; &lt;ConnectedRouter history={history}&gt;{children}&lt;/ConnectedRouter&gt;,
  ({ children }) =&gt; (
    &lt;JssProvider jss={jss} generateClassName={generateClassName}&gt;
      {children}
    &lt;/JssProvider&gt;
  ),
  ({ children }) =&gt; &lt;MuiThemeProvider theme={theme}&gt;{children}&lt;/MuiThemeProvider&gt;,
  ({ children }) =&gt; (
    &lt;MuiPickersUtilsProvider utils={MomentUtils}&gt;{children}&lt;/MuiPickersUtilsProvider&gt;
  )
);

ReactDOM.render(
  React.createElement(withProviders(App)), 
  document.getElementById('root')
);
</code></pre>
<p>Alright. This also works. Buuuuut, I mean, c'mon, this somehow seems <em>worse</em>, right?</p>
<p>Is there a middle-ground of readability and less duplicated code? Of course! Let's just write a little helper to take pairs of components and their props and pass that to <code>nest</code>.</p>
<h2 id="nesting-with-componentprop-pairs">Nesting with Component/Prop Pairs</h2>
<pre><code class="language-js">// Nest components in this order (top to bottom)
const AppProviders = nestPairs(
  [Provider, { store }],
  [ConnectedRouter, { history }],
  [JssProvider, { jss, generateClassName }],
  [MuiThemeProvider, { theme }],
  [MuiPickersUtilsProvider, { utils: MomentUtils }]
);

ReactDOM.render(
  &lt;AppProviders&gt;
    &lt;App /&gt;
  &lt;/AppProviders&gt;, 
  document.getElementById('root'));
</code></pre>
<p>Hey! That looks more readable <em>and</em> solves the prop passing issue. This is what <code>nestPairs</code> looks like:</p>
<pre><code class="language-js">function nestPairs(...componentPropPairs) {
  return nest.apply(
    this,
    componentPropPairs.map(([ComponentClass, props]) =&gt; 
      ({ children }) =&gt; 
        React.createElement(ComponentClass, { ...props, children })
    )
  );
}
</code></pre>
<p>And in TypeScript (what I'm using):</p>
<pre><code class="language-typescript">function nestPairs(this: any, ...componentPropPairs: Array&lt;[React.ComponentType, any]&gt;) {
  return nest.apply(
    this,
    componentPropPairs.map(([ComponentClass, props]): React.StatelessComponent&lt;
      any
    &gt; =&gt; ({ children }) =&gt; React.createElement&lt;any&gt;(ComponentClass, { ...props, children }))
  );
}
</code></pre>
<p>We are taking the array pairs and mapping them to stateless components with all the blanks filled in. This keeps the input
relatively simple while still allowing custom props per component. In TypeScript, the downside is that you lose the strong
typing compared to the previous version but I'm willing to do that since in my case, this is only used in the entrypoint of
our app so it'll be real apparent if things don't work.</p>

</div>

<div class="ui horizontal divider">
  About Kamran
</div>

<div class="ui items">
  <div class="item">
    <div class="ui small circular image">
      <img src="/assets/images/me.jpg" title="Kamran Ayub">
    </div>

    <div class="content">
      <div class="description">
        I&#x27;m a technologist, speaker, and Pluralsight author and I specialize in building full-stack solutions with a focus on modern web technology and cloud native architecture.
      </div>
      <div class="extra">
        <a class="ui circular icon button" href="https://twitter.com/kamranayub" title="Twitter">
  <i class="twitter icon"></i>
</a>
<a class="ui circular icon button" href="https://github.com/kamranayub" title="GitHub">
  <i class="github icon"></i>
</a>
<a class="ui circular icon button" href="https://instagram.com/subkamran" title="Instagram">
  <i class="instagram icon"></i>
</a>
<a class="ui circular icon button" href="http://www.youtube.com/c/Kamranicus " title="YouTube">
  <i class="youtube icon"></i>
</a>
<a class="ui circular icon button" href="https://twitch.tv/kamranicus " title="YouTube">
  <i class="twitch icon"></i>
</a>
<a class="ui circular icon button" href="https://www.linkedin.com/in/subkamran" title="LinkedIn">
  <i class="linkedin icon"></i>
</a>
      </div>
    </div>
  </div>
</div>

<div id="disqus_thread"></div>

<script type="text/javascript">
    var disqus_shortname = 'kamranicus';
    var disqus_identifier = '2018-07-07-react-nesting-components-flat';
    var disqus_title = 'Flattening Deeply Nested Components in React';
    var disqus_url = 'https://kamranicus.com/posts/2018-07-07-react-nesting-components-flat';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      <!-- Disqus -->
    </div>
  </div>

  <div class="ui divider"></div>
  
  <!-- Footer -->
  <footer>   
    <div class="ui center aligned container">
  <p class="ui grey sub header">Copyright © Kamran Ayub 2018</p>
  
  <div class="ui basic vertical segment">
    <a class="ui circular icon button" href="https://twitter.com/kamranayub" title="Twitter">
  <i class="twitter icon"></i>
</a>
<a class="ui circular icon button" href="https://github.com/kamranayub" title="GitHub">
  <i class="github icon"></i>
</a>
<a class="ui circular icon button" href="https://instagram.com/subkamran" title="Instagram">
  <i class="instagram icon"></i>
</a>
<a class="ui circular icon button" href="http://www.youtube.com/c/Kamranicus " title="YouTube">
  <i class="youtube icon"></i>
</a>
<a class="ui circular icon button" href="https://twitch.tv/kamranicus " title="YouTube">
  <i class="twitch icon"></i>
</a>
<a class="ui circular icon button" href="https://www.linkedin.com/in/subkamran" title="LinkedIn">
  <i class="linkedin icon"></i>
</a>
  </div>

  <p class="ui basic vertical segment">      
    <a href="http://feeds.feedburner.com/Kamranicus" class="ui right labeled icon button">
      Subscribe via RSS or email
      <i class="right rss icon"></i>
    </a>
  </p>  
  <p class="ui tiny basic vertical segment">
    <a href="https://wyam.io">Statically generated by Wyam</a>
  </p>
</div>

  </footer>

  <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous"></script>
  <script src="/assets/ui/semantic.min.js"></script>
  <script src="/assets/js/highlight.pack.js"></script>

  

  <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>